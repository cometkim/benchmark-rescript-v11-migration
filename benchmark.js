const { Benchmark } = require('benchmark');

const mod10 = require('./res10/src/Decoder');
const mod11 = require('./res11/src/Decoder');

const de10 = mod10.make([]);
const de11 = mod11.make([]);

const decode10 = buf => {
  return mod10.decode(de10, buf);
};
const decode11 = buf => {
  return mod11.decode(de11, buf);
};

const complex = new Uint8Array([0x88, 0xa3, 0x69, 0x6e, 0x74, 0x1, 0xa5, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0xcb, 0x3f, 0xe0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xa7, 0x62, 0x6f, 0x6f, 0x6c, 0x65, 0x61, 0x6e, 0xc3, 0xa4, 0x6e, 0x75, 0x6c, 0x6c, 0xc0, 0xa6, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0xa7, 0x66, 0x6f, 0x6f, 0x20, 0x62, 0x61, 0x72, 0xa5, 0x61, 0x72, 0x72, 0x61, 0x79, 0x92, 0xa3, 0x66, 0x6f, 0x6f, 0xa3, 0x62, 0x61, 0x72, 0xa6, 0x6f, 0x62, 0x6a, 0x65, 0x63, 0x74, 0x82, 0xa3, 0x66, 0x6f, 0x6f, 0x1, 0xa3, 0x62, 0x61, 0x7a, 0xcb, 0x3f, 0xe0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xa4, 0x64, 0x61, 0x74, 0x65, 0xd7, 0xff, 0xbe, 0x7f, 0x17, 0x0, 0x60, 0xf8, 0x3c, 0x5f]);

console.log('decode10 result: ', decode10(complex));
console.log('decode11 result: ', decode11(complex));

const suite = new Benchmark.Suite();

console.log('run benchmark...');

suite.add('decode10', () => {
  decode10(complex);
});

suite.add('decode11', () => {
  decode11(complex);
});

suite.on('cycle', (event) => {
  console.log(event.target.toString());
});

suite.run();
